import{j as e,a as I,r as s,W as B,Y as M}from"./app-B4Ukg5N5.js";import"./index-DMIup_xY.js";import{T as Y}from"./TextInput-1KVYgPtR.js";import{n as m}from"./numeral-CMrXdoQk.js";import{P as $}from"./PrimaryButton-Dd1WpMyz.js";import{S as q}from"./SecondaryButton-CfRIIcuX.js";import z from"./PaymentMobile-BiMDdEOQ.js";import"./transition-QjNedhhF.js";function A({isOpen:p}){return p&&e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-96",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-xl font-semibold text-green-600",children:"Success"})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-green-600",children:"Your payment was successful!"})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(I,{href:route("pos"),className:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600",children:"Back to Store"})})]})})}function ee({no_invoice:p,kategori:f,akun:u,success:h}){const[r,w]=s.useState([]),[k,C]=s.useState(!1),[g,T]=s.useState(1),[d,j]=s.useState(0),[o,E]=s.useState(0),[b,y]=s.useState({}),{data:D,setData:x,post:_,errors:J,processing:N,recentlySuccessful:K}=B({produk:[],nominal:""}),v=s.useRef(r);s.useEffect(()=>{v.current!==r&&(x({produk:r.map(a=>a),nominal:u.map(a=>({id_akun:a.id,nominal:""}))}),v.current=r)},[r,x]),s.useEffect(()=>{const a=r.reduce((t,n)=>t+n.ttl_rp,0);E(a)},[r]);const F=a=>{a.preventDefault(),_(route("pos.save_payment"),{preserveScroll:!0,onSuccess:()=>{localStorage.removeItem("cardItems")},onError:t=>{console.error("Error saat mengirim data:",t),alert("Pembayaran gagal, cek kembali data Anda.")}})};s.useEffect(()=>{const a=localStorage.getItem("cardItems");if(a){const t=JSON.parse(a);w(t)}},[]);const O=a=>{a.target.onerror=null,a.target.src="/storage/image/image.png"},R=a=>{C(!k),T(a)},S=(a,t)=>{x(n=>{const i=n.nominal.map(c=>c.id_akun===a?{...c,nominal:parseFloat(t)||0}:c),l=i.reduce((c,V)=>c+V.nominal,0);return j(l),{...n,nominal:i,totalPembayaran:l}}),y(n=>({...n,[a]:t}))},P=a=>{x(t=>{const n=t.nominal.map(l=>l.id_akun===a?{...l,nominal:parseFloat(o)||0}:l),i=n.reduce((l,c)=>l+c.nominal,0);return j(i),{...t,nominal:n,totalPembayaran:i}}),y(t=>({...t,[a]:o.toString()}))};return e.jsxs("form",{onSubmit:F,className:"bg-[#F8F8F8] md:py-14 md:px-8  flex h-full justify-center w-full",children:[e.jsx(M,{title:"POS Payment"}),e.jsxs("div",{className:"w-1/3 border border-gray-300 rounded-md mr-4 hidden md:block",children:[e.jsx("div",{className:"border-b  p-4  bg-slate-200",children:e.jsxs("h5",{className:"font-mona font-bold text-gray-700",children:["Payment",e.jsxs("span",{className:"float-right",children:["#",p]})]})}),e.jsx("div",{className:" overflow-y-scroll h-96 ",children:r.map(a=>e.jsxs("div",{className:"flex items-center border-b pb-4 ml-4",children:[e.jsx("img",{src:a.foto,alt:"Product Image",className:"w-20 h-20 object-cover rounded",onError:O}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold font-mona",children:a.nama_produk}),e.jsxs("p",{className:"text-sm text-[#F46700] font-mona",children:[m(a.qty).format("0,0")," x Rp.",m(a.harga).format("0,0")," =",e.jsxs("span",{children:[" ","Rp.",m(a.ttl_rp).format("0,0")]})]})]})]},a.id))})]}),e.jsxs("div",{className:"w-2/3 border border-gray-300 rounded-md flext justify-center hidden md:block",children:[e.jsx("h5",{className:"text-center mt-6 font-mona text-gray-400 text-lg ",children:"Total Tagihan"}),e.jsxs("h5",{className:"text-center mt-6 font-mona  text-4xl",children:[e.jsx("span",{className:"text-sm align-top",children:"Rp "}),m(o).format("0,0")]}),e.jsx("h5",{className:"text-center mt-6 font-mona text-gray-400 text-lg ",children:"Total Pembayaran"}),e.jsxs("h5",{className:"text-center mt-6 font-mona  text-4xl",children:[e.jsx("span",{className:"text-sm align-top",children:"Rp "}),m(d).format("0,0")]}),e.jsx("h5",{className:"text-center mt-6 font-mona text-gray-400 text-lg ",children:"Kembalian"}),e.jsxs("h5",{className:"text-center mt-6 font-mona  text-lg",children:[e.jsx("span",{className:"text-sm align-top",children:"Rp "}),m(d-o<0?0:d-o).format("0,0")]}),e.jsx("div",{className:"flex justify-center mt-12",children:f.map(a=>e.jsx("button",{className:`py-3 px-6 border-b-2 ${g===a.id?"border-[#F46700] text-[#F46700]":""} `,onClick:t=>{t.preventDefault(),R(a.id)},children:a.kategori},a.id))}),e.jsx("div",{className:"mt-2 pt-10 px-10 xl:px-44  grid grid-cols-2 gap-3 place-items-center",children:u.map(a=>e.jsxs("div",{className:` relative w-full ${g===a.kategori_akun_id?"":"hidden"}`,children:[e.jsx(Y,{type:"number",id:"nominal",className:"w-full rounded-lg h-11 pr-8",placeholder:a.akun,value:b[a.id]||"",autocomplete:"off",onChange:t=>S(a.id,t.target.value)}),e.jsx("a",{className:"absolute top-1/2 right-2 transform -translate-y-1/2",onClick:t=>P(a.id,t.target.value),children:e.jsx("i",{className:"fa-regular fa-copy"})})]},a.id))}),e.jsxs("div",{className:"mt-8 bg-gray-100 border-t border-gray-300 p-4 flex justify-between items-center",children:[e.jsx(I,{href:route("pos"),children:e.jsx(q,{children:"Cancel"})}),e.jsxs($,{disabled:o>d||N,submitProcessing:N,children:["Pay Now ",h]})]})]}),e.jsx(z,{cardItems:r,numeral:m,totalTagihan:o,totalPembayaran:d,kategori:f,akun:u,handleNominalChange:S,handleCopyToInput:P,inputValues:b}),e.jsx(A,{isOpen:h==1})]})}export{ee as default};
