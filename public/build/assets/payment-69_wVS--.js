import{r as s,W as w,j as a,Y as F,a as R}from"./app-C0pH-kjp.js";import"./Dropdown-Efsnfll1.js";import{T as O}from"./TextInput-CaEemtXa.js";import{n}from"./numeral-BcIraJbz.js";import{P as $}from"./PrimaryButton-ko-AX2ak.js";import{S as B}from"./SecondaryButton-NmC5ZpDO.js";import"./transition-C0GnW4do.js";function H({no_invoice:g,kategori:b,akun:i}){const[r,j]=s.useState([]),[y,N]=s.useState(!1),[x,v]=s.useState(1),[l,S]=s.useState(0),[c,P]=s.useState(0),{data:D,setData:d,post:I,errors:V,processing:p,recentlySuccessful:q}=w({produk:[],nominal:""}),u=s.useRef(r);s.useEffect(()=>{u.current!==r&&(d({produk:r.map(e=>e),nominal:i.map(e=>({id_akun:e.id,nominal:""}))}),u.current=r)},[r,d]),s.useEffect(()=>{const e=r.reduce((t,m)=>t+m.ttl_rp,0);P(e)},[r]);const k=e=>{e.preventDefault(),I(route("pos.save_payment"),{preserveScroll:!0,onSuccess:()=>{alert("Pembayaran berhasil"),localStorage.removeItem("cardItems")},onError:t=>{console.error("Error saat mengirim data:",t),alert("Pembayaran gagal, cek kembali data Anda.")}})};s.useEffect(()=>{const e=localStorage.getItem("cardItems");if(e){const t=JSON.parse(e);j(t)}},[]);const E=e=>{e.target.onerror=null,e.target.src="/image/image.png"},T=e=>{N(!y),v(e)},C=(e,t)=>{d(m=>{const f=m.nominal.map(o=>o.id_akun===e?{...o,nominal:parseFloat(t)||0}:o),h=f.reduce((o,_)=>o+_.nominal,0);return S(h),{...m,nominal:f,totalPembayaran:h}})};return a.jsxs("form",{onSubmit:k,className:"bg-[#F8F8F8] py-14 px-8  flex h-full",children:[a.jsx(F,{title:"POS Payment"}),a.jsxs("div",{className:"w-1/3 border border-gray-300 rounded-md mr-4 ",children:[a.jsx("div",{className:"border-b  p-4  bg-slate-200",children:a.jsxs("h5",{className:"font-mona font-bold text-gray-700",children:["Payment",a.jsxs("span",{className:"float-right",children:["#",g]})]})}),a.jsx("div",{className:" overflow-y-scroll h-96 ",children:r.map(e=>a.jsxs("div",{className:"flex items-center border-b pb-4 ml-4",children:[a.jsx("img",{src:`/image/${e.foto}`,alt:"Product Image",className:"w-20 h-20 object-cover rounded",onError:E}),a.jsxs("div",{className:"ml-4 flex-1",children:[a.jsx("h2",{className:"text-lg font-semibold font-mona",children:e.nama_produk}),a.jsxs("p",{className:"text-sm text-[#F46700] font-mona",children:[n(e.qty).format("0,0")," x Rp.",n(e.harga).format("0,0")," =",a.jsxs("span",{children:[" ","Rp.",n(e.ttl_rp).format("0,0")]})]})]})]},e.id))})]}),a.jsxs("div",{className:"w-2/3 border border-gray-300 rounded-md flext justify-center",children:[a.jsx("h5",{className:"text-center mt-6 font-mona text-gray-400 text-lg ",children:"Total Tagihan"}),a.jsxs("h5",{className:"text-center mt-6 font-mona  text-4xl",children:[a.jsx("span",{className:"text-sm align-top",children:"Rp "}),n(c).format("0,0")]}),a.jsx("h5",{className:"text-center mt-6 font-mona text-gray-400 text-lg ",children:"Total Pembayaran"}),a.jsxs("h5",{className:"text-center mt-6 font-mona  text-4xl",children:[a.jsx("span",{className:"text-sm align-top",children:"Rp "}),n(l).format("0,0")]}),a.jsx("h5",{className:"text-center mt-6 font-mona text-gray-400 text-lg ",children:"Kembalian"}),a.jsxs("h5",{className:"text-center mt-6 font-mona  text-4xl",children:[a.jsx("span",{className:"text-sm align-top",children:"Rp "}),n(l-c<0?0:l-c).format("0,0")]}),a.jsx("div",{className:"flex justify-center mt-24",children:b.map(e=>a.jsx("button",{className:`py-3 px-6 border-b-2 ${x===e.id?"border-[#F46700] text-[#F46700]":""} `,onClick:t=>{t.preventDefault(),T(e.id)},children:e.kategori},e.id))}),a.jsx("div",{className:"mt-2 pt-10 px-10 xl:px-44  grid grid-cols-2 gap-3 place-items-center",children:i.map(e=>a.jsx("div",{className:`w-full ${x===e.kategori_akun_id?"":"hidden"}`,children:a.jsx(O,{type:"number",id:"nominal",className:"w-full rounded-lg h-11",placeholder:e.akun,onChange:t=>C(e.id,t.target.value)})},e.id))}),a.jsxs("div",{className:"mt-8 bg-gray-100 border-t border-gray-300 p-4 flex justify-between items-center",children:[a.jsx(R,{href:route("pos"),children:a.jsx(B,{children:"Cancel"})}),a.jsx($,{disabled:c>l||p,submitProcessing:p,children:"Pay"})]})]})]})}export{H as default};
