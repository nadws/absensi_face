import{r,W as _,j as a,Y as F,a as R}from"./app-D1Lz3fTl.js";import"./Dropdown-B4lymdiS.js";import{T as O}from"./TextInput-BCEa0xCf.js";import{n}from"./numeral-Cj4gTB6u.js";import{P as $}from"./PrimaryButton-CH6MXVbr.js";import{S as B}from"./SecondaryButton-ylHKE3O0.js";import D from"./PaymentMobile-dG0WK4Dl.js";import"./transition-CedOssAe.js";function L({no_invoice:g,kategori:b,akun:i}){const[s,j]=r.useState([]),[y,N]=r.useState(!1),[x,v]=r.useState(1),[m,P]=r.useState(0),[o,S]=r.useState(0),{data:V,setData:d,post:I,errors:q,processing:p,recentlySuccessful:A}=_({produk:[],nominal:""}),u=r.useRef(s);r.useEffect(()=>{u.current!==s&&(d({produk:s.map(e=>e),nominal:i.map(e=>({id_akun:e.id,nominal:""}))}),u.current=s)},[s,d]),r.useEffect(()=>{const e=s.reduce((t,c)=>t+c.ttl_rp,0);S(e)},[s]);const k=e=>{e.preventDefault(),I(route("pos.save_payment"),{preserveScroll:!0,onSuccess:()=>{alert("Pembayaran berhasil"),localStorage.removeItem("cardItems")},onError:t=>{console.error("Error saat mengirim data:",t),alert("Pembayaran gagal, cek kembali data Anda.")}})};r.useEffect(()=>{const e=localStorage.getItem("cardItems");if(e){const t=JSON.parse(e);j(t)}},[]);const w=e=>{e.target.onerror=null,e.target.src="/image/image.png"},E=e=>{N(!y),v(e)},T=(e,t)=>{d(c=>{const f=c.nominal.map(l=>l.id_akun===e?{...l,nominal:parseFloat(t)||0}:l),h=f.reduce((l,C)=>l+C.nominal,0);return P(h),{...c,nominal:f,totalPembayaran:h}})};return a.jsxs("form",{onSubmit:k,className:"bg-[#F8F8F8] md:py-14 md:px-8  flex h-full justify-center w-full",children:[a.jsx(F,{title:"POS Payment"}),a.jsxs("div",{className:"w-1/3 border border-gray-300 rounded-md mr-4 hidden md:block",children:[a.jsx("div",{className:"border-b  p-4  bg-slate-200",children:a.jsxs("h5",{className:"font-mona font-bold text-gray-700",children:["Payment",a.jsxs("span",{className:"float-right",children:["#",g]})]})}),a.jsx("div",{className:" overflow-y-scroll h-96 ",children:s.map(e=>a.jsxs("div",{className:"flex items-center border-b pb-4 ml-4",children:[a.jsx("img",{src:`/image/${e.foto}`,alt:"Product Image",className:"w-20 h-20 object-cover rounded",onError:w}),a.jsxs("div",{className:"ml-4 flex-1",children:[a.jsx("h2",{className:"text-lg font-semibold font-mona",children:e.nama_produk}),a.jsxs("p",{className:"text-sm text-[#F46700] font-mona",children:[n(e.qty).format("0,0")," x Rp.",n(e.harga).format("0,0")," =",a.jsxs("span",{children:[" ","Rp.",n(e.ttl_rp).format("0,0")]})]})]})]},e.id))})]}),a.jsxs("div",{className:"w-2/3 border border-gray-300 rounded-md flext justify-center hidden md:block",children:[a.jsx("h5",{className:"text-center mt-6 font-mona text-gray-400 text-lg ",children:"Total Tagihan"}),a.jsxs("h5",{className:"text-center mt-6 font-mona  text-4xl",children:[a.jsx("span",{className:"text-sm align-top",children:"Rp "}),n(o).format("0,0")]}),a.jsx("h5",{className:"text-center mt-6 font-mona text-gray-400 text-lg ",children:"Total Pembayaran"}),a.jsxs("h5",{className:"text-center mt-6 font-mona  text-4xl",children:[a.jsx("span",{className:"text-sm align-top",children:"Rp "}),n(m).format("0,0")]}),a.jsx("h5",{className:"text-center mt-6 font-mona text-gray-400 text-lg ",children:"Kembalian"}),a.jsxs("h5",{className:"text-center mt-6 font-mona  text-lg",children:[a.jsx("span",{className:"text-sm align-top",children:"Rp "}),n(m-o<0?0:m-o).format("0,0")]}),a.jsx("div",{className:"flex justify-center mt-12",children:b.map(e=>a.jsx("button",{className:`py-3 px-6 border-b-2 ${x===e.id?"border-[#F46700] text-[#F46700]":""} `,onClick:t=>{t.preventDefault(),E(e.id)},children:e.kategori},e.id))}),a.jsx("div",{className:"mt-2 pt-10 px-10 xl:px-44  grid grid-cols-2 gap-3 place-items-center",children:i.map(e=>a.jsx("div",{className:`w-full ${x===e.kategori_akun_id?"":"hidden"}`,children:a.jsx(O,{type:"number",id:"nominal",className:"w-full rounded-lg h-11 ",placeholder:e.akun,onChange:t=>T(e.id,t.target.value)})},e.id))}),a.jsxs("div",{className:"mt-8 bg-gray-100 border-t border-gray-300 p-4 flex justify-between items-center",children:[a.jsx(R,{href:route("pos"),children:a.jsx(B,{children:"Cancel"})}),a.jsx($,{disabled:o>m||p,submitProcessing:p,children:"Pay Now"})]})]}),a.jsx(D,{cardItems:s,numeral:n,totalTagihan:o})]})}export{L as default};
